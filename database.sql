CREATE TABLE public.favoris (
    utilisateur_id integer NOT NULL,
    film_id integer NOT NULL
);
CREATE TABLE public.film (
    id integer NOT NULL,
    titre character varying(255) NOT NULL,
    annee integer NOT NULL,
    duree integer NOT NULL,
    synopsis character varying(255) NOT NULL,
    genres character varying(255) NOT NULL,
    prix_location double precision NOT NULL,
    affiche character varying(255) NOT NULL
);
ALTER TABLE public.film ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public.film_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);
CREATE TABLE public.jours (
    idjour smallint NOT NULL,
    nomjour character varying(10) NOT NULL
);
CREATE TABLE public.panier (
    id integer NOT NULL,
    utilisateur_id integer NOT NULL,
    date_creation timestamp(0) without time zone NOT NULL,
    statut character varying(255) NOT NULL
);
CREATE TABLE public.panier_film (
    id integer NOT NULL,
    quantite integer NOT NULL,
    panier_id integer NOT NULL,
    film_id integer NOT NULL
);
ALTER TABLE public.panier_film ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public.panier_film_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);
CREATE SEQUENCE public.panier_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;
ALTER SEQUENCE public.panier_id_seq OWNED BY public.panier.id;
ALTER TABLE public.panier ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public.panier_id_seq1
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);
CREATE TABLE public.promotion (
    idjour smallint NOT NULL,
    tauxpromo numeric(10,2) NOT NULL
);
CREATE TABLE public.utilisateur (
    id integer NOT NULL,
    email character varying(255) NOT NULL,
    password character varying(255) NOT NULL,
    role integer NOT NULL
);
ALTER TABLE public.utilisateur ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public.utilisateur_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);
INSERT INTO public.favoris VALUES (1, 6);
INSERT INTO public.favoris VALUES (1, 15);
INSERT INTO public.favoris VALUES (1, 25);
INSERT INTO public.favoris VALUES (1, 27);
INSERT INTO public.favoris VALUES (1, 10);
INSERT INTO public.favoris VALUES (1, 4);
INSERT INTO public.favoris VALUES (1, 28);
INSERT INTO public.favoris VALUES (2, 4);
INSERT INTO public.favoris VALUES (2, 5);
INSERT INTO public.film VALUES (15, 'Interstellar', 2014, 169, 'Alors que la Terre se meurt, une équipe d''astronautes traverse un trou de ver afin de trouver une nouvelle planète habitable.', 'Science-Fiction, Drame', 4.99, 'interstellar.jpeg');
INSERT INTO public.film VALUES (5, 'Inception', 2010, 148, 'Un voleur qui dérobe des secrets par le rêve est chargé d''implanter une idée dans l''esprit d''un homme.', 'Science-Fiction, Thriller', 3.5, 'Inception.jpg');
INSERT INTO public.film VALUES (16, 'Le Parrain', 1972, 175, 'L''histoire de la famille Corleone, une puissante dynastie de la mafia sicilienne à New York.', 'Crime, Drame', 2.99, 'parrain.jpeg');
INSERT INTO public.film VALUES (19, 'Le Roi Lion', 1994, 88, 'Le jeune lion Simba doit trouver sa place dans le cycle de la vie après la mort tragique de son père Mufasa.', 'Animation, Famille', 2.5, 'leroilion.webp');
INSERT INTO public.film VALUES (9, 'Forrest Gump', 1994, 142, 'La vie extraordinaire d''un homme simple qui traverse les grands événements de l''Histoire américaine.', 'Drame, Comédie', 2.5, 'ForestGump.jpg');
INSERT INTO public.film VALUES (21, 'Fight Club', 1999, 139, 'Un employé de bureau insomniaque et un vendeur de savon charismatique créent un club de combat clandestin.', 'Drame, Thriller', 3.5, 'fightclub.jpg');
INSERT INTO public.film VALUES (8, 'The Dark Knight', 2008, 152, 'Batman doit affronter le Joker, un criminel anarchiste semant le chaos à Gotham.', 'Action, Thriller', 3.5, 'TheDarkKnight.jpg');
INSERT INTO public.film VALUES (13, 'Parasite', 2019, 132, 'Une famille pauvre infiltre la vie d''une famille riche, révélant des tensions sociales profondes.', 'Thriller, Drame', 3.5, 'Parasite.jpg');
INSERT INTO public.film VALUES (10, 'La La Land', 2016, 128, 'Deux artistes luttent pour réaliser leurs rêves à Los Angeles tout en tombant amoureux.', 'Romance, Musical', 3, 'Lalaland.webp');
INSERT INTO public.film VALUES (14, 'Le Fabuleux Destin d''Amélie Poulain', 2001, 122, 'Amélie décide de changer la vie de ceux qui l''entourent avec de petites attentions.', 'Comédie, Romance', 2.5, 'LeFabuleuxDestin.webp');
INSERT INTO public.film VALUES (11, 'Gladiator', 2000, 155, 'Un général romain trahi devient gladiateur et cherche à venger sa famille.', 'Action, Historique', 3.5, 'Gladiator.png');
INSERT INTO public.film VALUES (23, 'Inglourious Basterds', 2009, 153, 'Dans la France occupée, un groupe de soldats juifs américains organise des actes de vengeance contre les nazis.', 'Guerre, Action', 4.99, 'inglourious.jpeg');
INSERT INTO public.film VALUES (6, 'Le Seigneur des Anneaux : La Communauté de l''Anneau', 2001, 178, 'Un jeune hobbit doit détruire un anneau maléfique pour sauver la Terre du Milieu.', 'Fantasy, Aventure', 4, 'SeigneurAnneau.jpg');
INSERT INTO public.film VALUES (12, 'Avengers: Endgame', 2019, 181, 'Les super-héros tentent de réparer les conséquences catastrophiques d''un univers fragmenté.', 'Action, Science-Fiction', 4.5, 'Endgame.jpg');
INSERT INTO public.film VALUES (4, 'Avatar', 2009, 162, 'Malgré sa paralysie, Jake Sully, un ancien marine immobilisé dans un fauteuil roulant, est resté un combattant au plus profond de son être. Il est recruté pour se rendre à des années-lumière de la Terre, sur Pandora, où de puissants groupes industriels', 'Aventure, Science-Fiction', 7.99, 'Avatar.jpg');
INSERT INTO public.film VALUES (1, 'Titanic', 1998, 194, 'Un bateau qui coule et tout le monde meurt !', 'Drame, Romance', 11.99, 'Titanic.jpeg');
INSERT INTO public.film VALUES (17, 'Pulp Fiction', 1994, 154, 'Les vies de deux tueurs à gages, d''un boxeur et de deux cambrioleurs s''entremêlent dans quatre histoires de violence.', 'Crime, Drame', 3.5, 'pulp_fiction.jpg');
INSERT INTO public.film VALUES (18, 'Matrix', 1999, 136, 'Un programmeur informatique découvre que la réalité n''est qu''une simulation créée par des machines pour asservir l''humanité.', 'Science-Fiction, Action', 2.99, 'matrix.jpg');
INSERT INTO public.film VALUES (20, 'Seven', 1995, 127, 'Deux inspecteurs traquent un tueur en série qui utilise les sept péchés capitaux pour mettre en scène ses meurtres.', 'Thriller, Crime', 3.99, 'seven.jpg');
INSERT INTO public.film VALUES (22, 'Shutter Island', 2010, 138, 'En 1954, deux marshals enquêtent sur la disparition d''une patiente d''un hôpital psychiatrique situé sur une île isolée.', 'Thriller, Mystère', 4.5, 'shutter_island.jpg');
INSERT INTO public.film VALUES (30, 'Whiplash', 2014, 107, 'Un jeune batteur de jazz talentueux est poussé à ses limites par un instructeur de musique impitoyable.', 'Drame, Musique', 3.99, 'whiplash.jpg');
INSERT INTO public.film VALUES (32, 'Coco', 2017, 105, 'Miguel, un jeune garçon passionné de musique, se retrouve transporté dans le monde coloré des ancêtres.', 'Animation, Famille', 4.99, 'coco.jpg');
INSERT INTO public.film VALUES (28, 'Le Voyage de Chihiro', 2001, 125, 'Une jeune fille se retrouve enfermée dans un monde peuplé d''esprits après que ses parents aient été transformés en cochons.', 'Animation, Fantastique', 3.5, 'chihiro.webp');
INSERT INTO public.film VALUES (27, 'Your Name', 2016, 106, 'Deux adolescents vivant dans deux endroits différents échangent mystérieusement leurs corps de manière intermittente.', 'Animation, Drame', 3.99, 'yourname.webp');
INSERT INTO public.film VALUES (29, 'Django Unchained', 2012, 165, 'Un esclave libéré fait équipe avec un chasseur de primes allemand pour libérer sa femme d''un propriétaire de plantation brutal.', 'Western, Action', 4.5, 'djangounchained.jpg');
INSERT INTO public.film VALUES (31, 'Les Évadés', 1994, 142, 'Le récit de l''amitié liant deux prisonniers durant plusieurs décennies dans le centre pénitentiaire de Shawshank.', 'Drame', 2.99, 'evades.jpeg');
INSERT INTO public.film VALUES (33, 'Gone Girl', 2014, 149, 'Un homme voit sa vie basculer lorsque sa femme disparaît subitement et que les soupçons de la police et des médias se tournent vers lui.', 'Thriller, Mystère', 3.99, 'gonegirl.jpeg');
INSERT INTO public.film VALUES (26, 'Le Loup de Wall Street', 2013, 180, 'L''ascension fulgurante d''un courtier en bourse de New York et sa chute spectaculaire liée au crime et à la corruption.', 'Biopic, Comédie', 4.99, 'le-loup-de-wall-street.jpg');
INSERT INTO public.film VALUES (25, 'Dune', 2021, 155, 'L''histoire de Paul Atreides, un jeune homme brillant voué à un destin qui le dépasse, sur la planète la plus dangereuse de l''univers.', 'Science-Fiction, Aventure', 6.99, 'dune.webp');
INSERT INTO public.film VALUES (24, 'Joker', 2019, 122, 'Le portrait d''Arthur Fleck, un homme méprisé par la société qui devient l''un des criminels les plus célèbres de Gotham City.', 'Drame, Thriller', 5.5, 'joker.webp');
INSERT INTO public.film VALUES (35, 'Hunger Games', 2012, 142, 'Chaque année, dans les ruines de ce qui était autrefois l''Amérique du Nord, le Capitole, l''impitoyable capitale de la nation de Panem, oblige chacun de ses douze districts à envoyer un garçon et une fille - les "Tributs" - concourir aux Hunger Games. A', 'Action, Drame, Science-Fiction', 9.99, 'HungerGames.webp');
INSERT INTO public.jours VALUES (1, 'Lundi');
INSERT INTO public.jours VALUES (2, 'Mardi');
INSERT INTO public.jours VALUES (3, 'Mercredi');
INSERT INTO public.jours VALUES (4, 'Jeudi');
INSERT INTO public.jours VALUES (5, 'Vendredi');
INSERT INTO public.jours VALUES (6, 'Samedi');
INSERT INTO public.jours VALUES (7, 'Dimanche');
INSERT INTO public.panier VALUES (15, 1, '2026-02-01 17:50:10', 'actif');
INSERT INTO public.panier_film VALUES (2, 1, 15, 16);
INSERT INTO public.panier_film VALUES (3, 1, 15, 15);
INSERT INTO public.panier_film VALUES (4, 1, 15, 14);
INSERT INTO public.panier_film VALUES (5, 1, 15, 32);
INSERT INTO public.promotion VALUES (1, 10.00);
INSERT INTO public.promotion VALUES (2, 20.00);
INSERT INTO public.promotion VALUES (6, 30.00);
INSERT INTO public.promotion VALUES (7, 30.00);
INSERT INTO public.utilisateur VALUES (1, 'test@test.com', '$2y$13$2Y.UkBapdDTRjjmuuE4CAunwtSfAc9gCRmIKcvpdCnUtpGZsiw5..', 1);
INSERT INTO public.utilisateur VALUES (2, 'admin@admin.test', '$2y$13$p8nI0mzh6Uf.2MTCBk2l1.bWE21APxEo/sZgFKQE9zYZZBpWX3Kn6', 2);

ALTER TABLE ONLY public.favoris
    ADD CONSTRAINT favoris_pkey PRIMARY KEY (utilisateur_id, film_id);
ALTER TABLE ONLY public.film
    ADD CONSTRAINT film_pkey PRIMARY KEY (id);
ALTER TABLE ONLY public.jours
    ADD CONSTRAINT jours_pkey PRIMARY KEY (idjour);
ALTER TABLE ONLY public.panier_film
    ADD CONSTRAINT panier_film_pkey PRIMARY KEY (id);
ALTER TABLE ONLY public.panier
    ADD CONSTRAINT panier_pkey PRIMARY KEY (id);
ALTER TABLE ONLY public.promotion
    ADD CONSTRAINT promotion_pkey PRIMARY KEY (idjour);
ALTER TABLE ONLY public.utilisateur
    ADD CONSTRAINT utilisateur_pkey PRIMARY KEY (id);
CREATE INDEX idx_24cc0df2fb88e14f ON public.panier USING btree (utilisateur_id);
CREATE INDEX idx_76a29b5b567f5183 ON public.panier_film USING btree (film_id);
CREATE INDEX idx_76a29b5bf77d927c ON public.panier_film USING btree (panier_id);
CREATE INDEX idx_8933c432567f5183 ON public.favoris USING btree (film_id);
CREATE INDEX idx_8933c432fb88e14f ON public.favoris USING btree (utilisateur_id);
ALTER TABLE ONLY public.panier
    ADD CONSTRAINT fk_24cc0df2fb88e14f FOREIGN KEY (utilisateur_id) REFERENCES public.utilisateur(id);
ALTER TABLE ONLY public.panier_film
    ADD CONSTRAINT fk_76a29b5b567f5183 FOREIGN KEY (film_id) REFERENCES public.film(id);
ALTER TABLE ONLY public.panier_film
    ADD CONSTRAINT fk_76a29b5bf77d927c FOREIGN KEY (panier_id) REFERENCES public.panier(id);
ALTER TABLE ONLY public.favoris
    ADD CONSTRAINT fk_8933c432567f5183 FOREIGN KEY (film_id) REFERENCES public.film(id) ON DELETE CASCADE;
ALTER TABLE ONLY public.favoris
    ADD CONSTRAINT fk_8933c432fb88e14f FOREIGN KEY (utilisateur_id) REFERENCES public.utilisateur(id) ON DELETE CASCADE;
ALTER TABLE ONLY public.promotion
    ADD CONSTRAINT fk_c11d7dd19d82865 FOREIGN KEY (idjour) REFERENCES public.jours(idjour);

SELECT setval(pg_get_serial_sequence('public.film', 'id'), COALESCE(MAX(id), 1)) FROM public.film;
SELECT setval(pg_get_serial_sequence('public.utilisateur', 'id'), COALESCE(MAX(id), 1)) FROM public.utilisateur;
SELECT setval(pg_get_serial_sequence('public.panier', 'id'), COALESCE(MAX(id), 1)) FROM public.panier;
SELECT setval(pg_get_serial_sequence('public.panier_film', 'id'), COALESCE(MAX(id), 1)) FROM public.panier_film;
